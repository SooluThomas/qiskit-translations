

<!DOCTYPE html>
<html class="writer-html5" lang="de-DE" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qiskit.pulse.builder &mdash; Qiskit 0.20.0 Dokumentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme-override.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/jupyter-sphinx.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
        <script src="../../../_static/sphinx_tabs/tabs.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0-alpha.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Stichwortverzeichnis" href="../../../genindex.html" />
    <link rel="search" title="Suche" href="../../../search.html" />
    <script>
    (function () {
      'use strict'
      window._analytics = {
        segment_key: 'ffdYLviQze3kzomaINXNk6NwpY9LlXcw',
        coremetrics: false,
        optimizely: false,
        googleAddServices: false,
        fullStory: false,
        autoPageEventSpa: false,
        autoFormEvents: false,
        autoPageView: false
      }

      window.digitalData = {
        page: {
          pageInfo: {
            productTitle: 'IBM Q Experience',
            analytics: {
              category: 'Qiskit.org'
            }
          }
        }
      }

      window._analyticsReady = window._analyticsReady || new Promise((resolve) => {
        const script = document.createElement('script')
        script.async = true
        script.src = 'https://cloud.ibm.com/analytics/build/bluemix-analytics.min.js'
        document.head.appendChild(script)
        script.onload = resolve
        script.onerror = (err) => {
          console.warn('Error loading Bluemix Analytics script:', err)
          resolve()
        }
      })

      window._analyticsReady.then(() => {
        if (!window.bluemixAnalytics || !window.digitalData) { return }

        const category = window.digitalData.page.pageInfo.analytics.category
        const productTitle = window.digitalData.page.pageInfo.productTitle
        const routeName = 'api-documentation'

        window.bluemixAnalytics.pageEvent(category, routeName, {
          navigationType: 'pushState',
          productTitle: productTitle,
          title: document.title
        })
      })
    }());
    </script>
     

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #212121" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Qiskit
          

          
            
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Qiskit installieren</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Einführung in Qiskit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../the_elements.html">Die Qiskit Elemente</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development_strategy.html">Development Strategy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing_to_qiskit.html">An Qiskit mitwirken</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Häufig gestellte Fragen</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/circuits/index.html">Circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/circuits_advanced/index.html">Advanced Circuits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/pulse/index.html">Pulse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/simulators/index.html">High-Performance Simulators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/noise/index.html">Quantum System Error Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/optimization/index.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/finance/index.html">Finance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/chemistry/index.html">Chemistry</a></li>
</ul>
<p class="caption"><span class="caption-text">Libraries</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/circuit_library.html">Circuit Library</a></li>
</ul>
<p class="caption"><span class="caption-text">API-Referenzen</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/terra.html">Qiskit Terra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/aer.html">Qiskit Aer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/ignis.html">Qiskit Ignis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/aqua.html">Qiskit Aqua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/ibmq-provider.html">Qiskit IBM Quantum Provider</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://quantum-computing.ibm.com/docs/cloud/errors">Quantum Experience API error codes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Qiskit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Modul-Quellcode</a> &raquo;</li>
        
      <li>qiskit.pulse.builder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Quellcode für qiskit.pulse.builder</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># This code is part of Qiskit.</span>
<span class="c1">#</span>
<span class="c1"># (C) Copyright IBM 2020.</span>
<span class="c1">#</span>
<span class="c1"># This code is licensed under the Apache License, Version 2.0. You may</span>
<span class="c1"># obtain a copy of this license in the LICENSE.txt file in the root directory</span>
<span class="c1"># of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.</span>
<span class="c1">#</span>
<span class="c1"># Any modifications or derivative works of this code must retain this</span>
<span class="c1"># copyright notice, and modified files need to carry a notice indicating</span>
<span class="c1"># that they have been altered from the originals.</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;Use the pulse builder DSL to write pulse programs with an imperative syntax.</span>

<span class="sd">.. warning::</span>
<span class="sd">    The pulse builder interface is still in active development. It may have</span>
<span class="sd">    breaking API changes without deprecation warnings in future releases until</span>
<span class="sd">    otherwise indicated.</span>

<span class="sd">To begin pulse programming we must first initialize our program builder</span>
<span class="sd">context with :func:`build`, after which we can begin adding program</span>
<span class="sd">statements. For example, below we write a simple program that :func:`play`\s</span>
<span class="sd">a pulse:</span>

<span class="sd">.. jupyter-execute::</span>

<span class="sd">    from qiskit import execute, pulse</span>

<span class="sd">    d0 = pulse.DriveChannel(0)</span>

<span class="sd">    with pulse.build() as pulse_prog:</span>
<span class="sd">        pulse.play(pulse.Constant(100, 1.0), d0)</span>

<span class="sd">    pulse_prog.draw()</span>

<span class="sd">The builder initializes a :class:`pulse.Schedule`, ``pulse_prog``</span>
<span class="sd">and then begins to construct the program within the context. The output pulse</span>
<span class="sd">schedule will survive after the context is exited and can be executed like a</span>
<span class="sd">normal Qiskit schedule using ``qiskit.execute(pulse_prog, backend)``.</span>

<span class="sd">Pulse programming has a simple imperative style. This leaves the programmer</span>
<span class="sd">to worry about the raw experimental physics of pulse programming and not</span>
<span class="sd">constructing cumbersome data structures.</span>

<span class="sd">We can optionally pass a :class:`~qiskit.providers.BaseBackend` to</span>
<span class="sd">:func:`build` to enable enhanced functionality. Below, we prepare a Bell state</span>
<span class="sd">by automatically compiling the required pulses from their gate-level</span>
<span class="sd">representations, while simultaneously applying a long decoupling pulse to a</span>
<span class="sd">neighboring qubit. We terminate the experiment with a measurement to observe the</span>
<span class="sd">state we prepared. This program which mixes circuits and pulses will be</span>
<span class="sd">automatically lowered to be run as a pulse program:</span>

<span class="sd">.. jupyter-execute::</span>

<span class="sd">    import math</span>

<span class="sd">    from qiskit import pulse</span>
<span class="sd">    from qiskit.test.mock import FakeOpenPulse3Q</span>

<span class="sd">    # TODO: This example should use a real mock backend.</span>
<span class="sd">    backend = FakeOpenPulse3Q()</span>

<span class="sd">    d2 = pulse.DriveChannel(2)</span>

<span class="sd">    with pulse.build(backend) as bell_prep:</span>
<span class="sd">        pulse.u2(0, math.pi, 0)</span>
<span class="sd">        pulse.cx(0, 1)</span>

<span class="sd">    with pulse.build(backend) as decoupled_bell_prep_and_measure:</span>
<span class="sd">        # We call our bell state preparation schedule constructed above.</span>
<span class="sd">        with pulse.align_right():</span>
<span class="sd">            pulse.call(bell_prep)</span>
<span class="sd">            pulse.play(pulse.Constant(bell_prep.duration, 0.02), d2)</span>
<span class="sd">            pulse.barrier(0, 1, 2)</span>
<span class="sd">            registers = pulse.measure_all()</span>

<span class="sd">    decoupled_bell_prep_and_measure.draw()</span>

<span class="sd">With the pulse builder we are able to blend programming on qubits and channels.</span>
<span class="sd">While the pulse schedule is based on instructions that operate on</span>
<span class="sd">channels, the pulse builder automatically handles the mapping from qubits to</span>
<span class="sd">channels for you.</span>

<span class="sd">In the example below we demonstrate some more features of the pulse builder:</span>

<span class="sd">.. jupyter-execute::</span>

<span class="sd">    import math</span>

<span class="sd">    from qiskit import pulse, QuantumCircuit</span>
<span class="sd">    from qiskit.pulse import library</span>
<span class="sd">    from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">    backend = FakeOpenPulse2Q()</span>

<span class="sd">    with pulse.build(backend) as pulse_prog:</span>
<span class="sd">        # Create a pulse.</span>
<span class="sd">        gaussian_pulse = library.gaussian(10, 1.0, 2)</span>
<span class="sd">        # Get the qubit&#39;s corresponding drive channel from the backend.</span>
<span class="sd">        d0 = pulse.drive_channel(0)</span>
<span class="sd">        d1 = pulse.drive_channel(1)</span>
<span class="sd">        # Play a pulse at t=0.</span>
<span class="sd">        pulse.play(gaussian_pulse, d0)</span>
<span class="sd">        # Play another pulse directly after the previous pulse at t=10.</span>
<span class="sd">        pulse.play(gaussian_pulse, d0)</span>
<span class="sd">        # The default scheduling behavior is to schedule pulses in parallel</span>
<span class="sd">        # across channels. For example, the statement below</span>
<span class="sd">        # plays the same pulse on a different channel at t=0.</span>
<span class="sd">        pulse.play(gaussian_pulse, d1)</span>

<span class="sd">        # We also provide pulse scheduling alignment contexts.</span>
<span class="sd">        # The default alignment context is align_left.</span>

<span class="sd">        # The sequential context schedules pulse instructions sequentially in time.</span>
<span class="sd">        # This context starts at t=10 due to earlier pulses above.</span>
<span class="sd">        with pulse.align_sequential():</span>
<span class="sd">            pulse.play(gaussian_pulse, d0)</span>
<span class="sd">            # Play another pulse after at t=20.</span>
<span class="sd">            pulse.play(gaussian_pulse, d1)</span>

<span class="sd">            # We can also nest contexts as each instruction is</span>
<span class="sd">            # contained in its local scheduling context.</span>
<span class="sd">            # The output of a child context is a context-schedule</span>
<span class="sd">            # with the internal instructions timing fixed relative to</span>
<span class="sd">            # one another. This is schedule is then called in the parent context.</span>

<span class="sd">            # Context starts at t=30.</span>
<span class="sd">            with pulse.align_left():</span>
<span class="sd">                # Start at t=30.</span>
<span class="sd">                pulse.play(gaussian_pulse, d0)</span>
<span class="sd">                # Start at t=30.</span>
<span class="sd">                pulse.play(gaussian_pulse, d1)</span>
<span class="sd">            # Context ends at t=40.</span>

<span class="sd">            # Alignment context where all pulse instructions are</span>
<span class="sd">            # aligned to the right, ie., as late as possible.</span>
<span class="sd">            with pulse.align_right():</span>
<span class="sd">                # Shift the phase of a pulse channel.</span>
<span class="sd">                pulse.shift_phase(math.pi, d1)</span>
<span class="sd">                # Starts at t=40.</span>
<span class="sd">                pulse.delay(100, d0)</span>
<span class="sd">                # Ends at t=140.</span>

<span class="sd">                # Starts at t=130.</span>
<span class="sd">                pulse.play(gaussian_pulse, d1)</span>
<span class="sd">                # Ends at t=140.</span>

<span class="sd">            # Acquire data for a qubit and store in a memory slot.</span>
<span class="sd">            pulse.acquire(100, 0, pulse.MemorySlot(0))</span>

<span class="sd">            # We also support a variety of macros for common operations.</span>

<span class="sd">            # Measure all qubits.</span>
<span class="sd">            pulse.measure_all()</span>

<span class="sd">            # Delay on some qubits.</span>
<span class="sd">            # This requires knowledge of which channels belong to which qubits.</span>
<span class="sd">            # delay for 100 cycles on qubits 0 and 1.</span>
<span class="sd">            pulse.delay_qubits(100, 0, 1)</span>

<span class="sd">            # Call a quantum circuit. The pulse builder lazily constructs a quantum</span>
<span class="sd">            # circuit which is then transpiled and scheduled before inserting into</span>
<span class="sd">            # a pulse schedule.</span>
<span class="sd">            # NOTE: Quantum register indices correspond to physical qubit indices.</span>
<span class="sd">            qc = QuantumCircuit(2, 2)</span>
<span class="sd">            qc.cx(0, 1)</span>
<span class="sd">            pulse.call(qc)</span>
<span class="sd">            # Calling a small set of standard gates and decomposing to pulses is</span>
<span class="sd">            # also supported with more natural syntax.</span>
<span class="sd">            pulse.u3(0, math.pi, 0, 0)</span>
<span class="sd">            pulse.cx(0, 1)</span>


<span class="sd">            # It is also be possible to call a preexisting schedule</span>
<span class="sd">            tmp_sched = pulse.Schedule()</span>
<span class="sd">            tmp_sched += pulse.Play(gaussian_pulse, d0)</span>
<span class="sd">            pulse.call(tmp_sched)</span>

<span class="sd">            # We also support:</span>

<span class="sd">            # frequency instructions</span>
<span class="sd">            pulse.set_frequency(5.0e9, d0)</span>

<span class="sd">            # phase instructions</span>
<span class="sd">            pulse.shift_phase(0.1, d0)</span>

<span class="sd">            # offset contexts</span>
<span class="sd">            with pulse.phase_offset(math.pi, d0):</span>
<span class="sd">                pulse.play(gaussian_pulse, d0)</span>

<span class="sd">The above is just a small taste of what is possible with the builder. See the</span>
<span class="sd">rest of the module documentation for more information on its</span>
<span class="sd">capabilities.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">contextvars</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">ContextManager</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Mapping</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Tuple</span><span class="p">,</span>
    <span class="n">TypeVar</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
    <span class="n">NewType</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">circuit</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">standard_gates</span> <span class="k">as</span> <span class="n">gates</span>
<span class="kn">from</span> <span class="nn">qiskit.pulse</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">channels</span> <span class="k">as</span> <span class="n">chans</span><span class="p">,</span>
    <span class="n">configuration</span><span class="p">,</span>
    <span class="n">exceptions</span><span class="p">,</span>
    <span class="n">instructions</span><span class="p">,</span>
    <span class="n">macros</span><span class="p">,</span>
    <span class="n">library</span><span class="p">,</span>
    <span class="n">transforms</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">qiskit.pulse.instructions</span> <span class="kn">import</span> <span class="n">directives</span>
<span class="kn">from</span> <span class="nn">qiskit.pulse.schedule</span> <span class="kn">import</span> <span class="n">Schedule</span>

<span class="c1">#: contextvars.ContextVar[BuilderContext]: active builder</span>
<span class="n">BUILDER_CONTEXTVAR</span> <span class="o">=</span> <span class="n">contextvars</span><span class="o">.</span><span class="n">ContextVar</span><span class="p">(</span><span class="s2">&quot;backend&quot;</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># pylint: disable=invalid-name</span>

<span class="n">StorageLocation</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;StorageLocation&#39;</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">MemorySlot</span><span class="p">,</span> <span class="n">chans</span><span class="o">.</span><span class="n">RegisterSlot</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">_compile_lazy_circuit_before</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>
                                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Decorator thats schedules and calls the lazily compiled circuit before</span>
<span class="sd">    executing the decorated builder method.&quot;&quot;&quot;</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">_requires_backend</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Decorator a function to raise if it is called without a builder with a</span>
<span class="sd">    set backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">BackendNotSet</span><span class="p">(</span>
                <span class="s1">&#39;This function requires the builder to &#39;</span>
                <span class="s1">&#39;have a &quot;backend&quot; set.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">_PulseBuilder</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Builder context class.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">schedule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Schedule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_alignment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
                 <span class="n">default_transpiler_settings</span><span class="p">:</span> <span class="n">Mapping</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default_circuit_scheduler_settings</span><span class="p">:</span> <span class="n">Mapping</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the builder context.</span>

<span class="sd">        .. note::</span>
<span class="sd">            At some point we may consider incorpating the builder into</span>
<span class="sd">            the :class:`~qiskit.pulse.Schedule` class. However, the risk of</span>
<span class="sd">            this is tying the user interface to the intermediate</span>
<span class="sd">            representation. For now we avoid this at the cost of some code</span>
<span class="sd">            duplication.</span>

<span class="sd">        Args:</span>
<span class="sd">            backend (BaseBackend): Input backend to use in builder. If not set</span>
<span class="sd">                certain functionality will be unavailable.</span>
<span class="sd">            schedule: Initital schedule to build on. If not supplied</span>
<span class="sd">                a schedule will be created.</span>
<span class="sd">            name: Name of pulse program to be built. Only used if `schedule`</span>
<span class="sd">                is not ``None``.</span>
<span class="sd">            default_alignment: Default scheduling alignment policy for the</span>
<span class="sd">                builder. One of &#39;left&#39;, &#39;right&#39;, &#39;sequential&#39;, or an alignment</span>
<span class="sd">                contextmanager.</span>
<span class="sd">            default_transpiler_settings: Default settings for the transpiler.</span>
<span class="sd">            default_circuit_scheduler_settings: Default settings for the</span>
<span class="sd">                circuit to pulse scheduler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#: BaseBackend: Backend instance for context builder.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span> <span class="o">=</span> <span class="n">backend</span>

        <span class="c1">#: Union[None, ContextVar]: Token for this ``_PulseBuilder``&#39;s ``ContextVar``.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_ctx_token</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: pulse.Schedule: Active schedule of BuilderContext.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_schedule</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: QuantumCircuit: Lazily constructed quantum circuit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ContextManager: Default alignment context.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_alignment_context</span> <span class="o">=</span> <span class="n">_align</span><span class="p">(</span><span class="n">default_alignment</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_transpiler_settings</span> <span class="o">=</span> <span class="n">default_transpiler_settings</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">default_circuit_scheduler_settings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">default_circuit_scheduler_settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_circuit_scheduler_settings</span> <span class="o">=</span> \
            <span class="n">default_circuit_scheduler_settings</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># pulse.Schedule: Root program context-schedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schedule</span> <span class="o">=</span> <span class="n">schedule</span> <span class="ow">or</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_context_schedule</span><span class="p">(</span><span class="n">Schedule</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Schedule</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Enter this builder context and yield either the supplied schedule</span>
<span class="sd">        or the schedule created for the user.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The schedule that the builder will build on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backend_ctx_token</span> <span class="o">=</span> <span class="n">BUILDER_CONTEXTVAR</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_alignment_context</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule</span>

    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exit the builder context and compile the built pulse program.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_alignment_context</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
        <span class="n">BUILDER_CONTEXTVAR</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_backend_ctx_token</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">backend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the builder backend if set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[BaseBackend]: The builder&#39;s backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">context_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Schedule</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the current context schedule.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_schedule</span>

    <span class="nd">@property</span>
    <span class="nd">@_requires_backend</span>
    <span class="k">def</span> <span class="nf">num_qubits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the number of qubits in the backend.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">n_qubits</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transpiler_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The builder&#39;s transpiler settings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpiler_settings</span>

    <span class="nd">@transpiler_settings</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="nf">transpiler_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transpiler_settings</span> <span class="o">=</span> <span class="n">settings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">circuit_scheduler_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The builder&#39;s circuit to pulse scheduler settings.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_circuit_scheduler_settings</span>

    <span class="nd">@circuit_scheduler_settings</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="nf">circuit_scheduler_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_circuit_scheduler_settings</span> <span class="o">=</span> <span class="n">settings</span>

    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Schedule</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Compile and output the built pulse program.&quot;&quot;&quot;</span>
        <span class="c1"># Not much happens because we currently compile as we build.</span>
        <span class="c1"># This should be offloaded to a true compilation module</span>
        <span class="c1"># once we define a more sophisticated IR.</span>
        <span class="n">program</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context_schedule</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_context_schedule</span><span class="p">(</span><span class="n">Schedule</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">program</span>

    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="nf">set_context_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_schedule</span><span class="p">:</span> <span class="n">Schedule</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the current context&#39;s schedule for the builder.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_schedule</span> <span class="o">=</span> <span class="n">context_schedule</span>

    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="nf">append_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context_schedule</span><span class="p">:</span> <span class="n">Schedule</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a :class:`Schedule` to the builder&#39;s context schedule.</span>

<span class="sd">        Args:</span>
<span class="sd">            context_schedule: Schedule to append to the current context schedule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_schedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_schedule</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_compile_lazy_circuit_before</span>
    <span class="k">def</span> <span class="nf">append_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruction</span><span class="p">:</span> <span class="n">instructions</span><span class="o">.</span><span class="n">Instruction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add an instruction to the builder&#39;s context schedule.</span>

<span class="sd">        Args:</span>
<span class="sd">            instruction: Instruction to append.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_schedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instruction</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compile_lazy_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call a QuantumCircuit and append the output pulse schedule</span>
<span class="sd">        to the builder&#39;s context schedule.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">qiskit.compiler</span> <span class="k">as</span> <span class="nn">compiler</span>  <span class="c1"># pylint: disable=cyclic-import</span>

            <span class="n">lazy_circuit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span>
            <span class="c1"># reset lazy circuit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_circuit</span><span class="p">()</span>
            <span class="n">transpiled_circuit</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">transpile</span><span class="p">(</span><span class="n">lazy_circuit</span><span class="p">,</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
                                                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">transpiler_settings</span><span class="p">)</span>
            <span class="n">sched</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">transpiled_circuit</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="p">,</span>
                                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">circuit_scheduler_settings</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_schedule</span><span class="p">(</span><span class="n">sched</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">call_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schedule</span><span class="p">:</span> <span class="n">Schedule</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call a schedule and append to the builder&#39;s context schedule.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new circuit for lazy circuit scheduling.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">circuit</span><span class="o">.</span><span class="n">QuantumCircuit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span>

    <span class="nd">@_requires_backend</span>
    <span class="k">def</span> <span class="nf">call_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">circ</span><span class="p">:</span> <span class="n">circuit</span><span class="o">.</span><span class="n">QuantumCircuit</span><span class="p">,</span>
                     <span class="n">lazy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call a circuit in the pulse program.</span>

<span class="sd">        The circuit is assumed to be defined on physical qubits.</span>

<span class="sd">        If ``lazy == True`` this circuit will extend a lazily constructed</span>
<span class="sd">        quantum circuit. When an operation occurs that breaks the underlying</span>
<span class="sd">        circuit scheduling assumptions such as adding a pulse instruction or</span>
<span class="sd">        changing the alignment context the circuit will be</span>
<span class="sd">        transpiled and scheduled into pulses with the current active settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            circ: Circuit to call.</span>
<span class="sd">            lazy: If false the circuit will be transpiled and pulse scheduled</span>
<span class="sd">                immediately. Otherwise, it will extend the active lazy circuit</span>
<span class="sd">                as defined above.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lazy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_circuit</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_call_circuit</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_call_circuit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circ</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_circuit</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">creg</span> <span class="ow">in</span> <span class="n">circ</span><span class="o">.</span><span class="n">cregs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span><span class="o">.</span><span class="n">add_register</span><span class="p">(</span><span class="n">creg</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">circuit</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">CircuitError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lazy_circuit</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@_requires_backend</span>
    <span class="k">def</span> <span class="nf">call_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">gate</span><span class="p">:</span> <span class="n">circuit</span><span class="o">.</span><span class="n">Gate</span><span class="p">,</span>
                  <span class="n">qubits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
                  <span class="n">lazy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the circuit ``gate`` in the pulse program.</span>

<span class="sd">        The qubits are assumed to be defined on physical qubits.</span>

<span class="sd">        If ``lazy == True`` this circuit will extend a lazily constructed</span>
<span class="sd">        quantum circuit. When an operation occurs that breaks the underlying</span>
<span class="sd">        circuit scheduling assumptions such as adding a pulse instruction or</span>
<span class="sd">        changing the alignment context the circuit will be</span>
<span class="sd">        transpiled and scheduled into pulses with the current active settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            gate: Gate to call.</span>
<span class="sd">            qubits: Qubits to call gate on.</span>
<span class="sd">            lazy: If false the circuit will be transpiled and pulse scheduled</span>
<span class="sd">                immediately. Otherwise, it will extend the active lazy circuit</span>
<span class="sd">                as defined above.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">iter</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">qubits</span> <span class="o">=</span> <span class="p">(</span><span class="n">qubits</span><span class="p">,)</span>

        <span class="n">qc</span> <span class="o">=</span> <span class="n">circuit</span><span class="o">.</span><span class="n">QuantumCircuit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_qubits</span><span class="p">)</span>
        <span class="n">qc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">qargs</span><span class="o">=</span><span class="n">qubits</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call_circuit</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">)</span>


<div class="viewcode-block" id="build"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.build.html#qiskit.pulse.builder.build">[Doku]</a><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">schedule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Schedule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">default_alignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
          <span class="n">default_transpiler_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">default_circuit_scheduler_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="n">Schedule</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Create a context manager for launching the imperative pulse builder DSL.</span>

<span class="sd">    To enter a building context and starting building a pulse program:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import execute, pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.play(pulse.Constant(100, 0.5), d0)</span>


<span class="sd">    While the output program ``pulse_prog`` cannot be executed as we are using</span>
<span class="sd">    a mock backend. If a real backend is being used, executing the program is</span>
<span class="sd">    done with:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        qiskit.execute(pulse_prog, backend)</span>

<span class="sd">    Args:</span>
<span class="sd">        backend (BaseBackend): A Qiskit backend. If not supplied certain</span>
<span class="sd">            builder functionality will be unavailable.</span>
<span class="sd">        schedule: a *mutable* pulse Schedule in which your pulse program will</span>
<span class="sd">            be built.</span>
<span class="sd">        name: Name of pulse program to be built. Only used if `schedule`</span>
<span class="sd">            is not ``None``.</span>
<span class="sd">        default_alignment: Default scheduling alignment for builder.</span>
<span class="sd">            One of ``left``, ``right``, ``sequential`` or an alignment</span>
<span class="sd">            contextmanager.</span>
<span class="sd">        default_transpiler_settings: Default settings for the transpiler.</span>
<span class="sd">        default_circuit_scheduler_settings: Default settings for the</span>
<span class="sd">            circuit to pulse scheduler.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A new builder context which has the active builder inititalized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_PulseBuilder</span><span class="p">(</span>
        <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span>
        <span class="n">schedule</span><span class="o">=</span><span class="n">schedule</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">default_alignment</span><span class="o">=</span><span class="n">default_alignment</span><span class="p">,</span>
        <span class="n">default_transpiler_settings</span><span class="o">=</span><span class="n">default_transpiler_settings</span><span class="p">,</span>
        <span class="n">default_circuit_scheduler_settings</span><span class="o">=</span><span class="n">default_circuit_scheduler_settings</span><span class="p">)</span></div>


<span class="c1"># Builder Utilities</span>
<span class="k">def</span> <span class="nf">_active_builder</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_PulseBuilder</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the active builder in the active context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The active active builder in this context.</span>

<span class="sd">    Raises:</span>
<span class="sd">        exceptions.NoActiveBuilder: If a pulse builder function is called</span>
<span class="sd">        outside of a builder context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">BUILDER_CONTEXTVAR</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">LookupError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NoActiveBuilder</span><span class="p">(</span>
            <span class="s1">&#39;A Pulse builder function was called outside of &#39;</span>
            <span class="s1">&#39;a builder context. Try calling within a builder &#39;</span>
            <span class="s1">&#39;context, eg., &quot;with pulse.build() as schedule: ...&quot;.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="active_backend"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.active_backend.html#qiskit.pulse.builder.active_backend">[Doku]</a><span class="k">def</span> <span class="nf">active_backend</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Get the backend of the currently active builder context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        BaseBackend: The active backend in the currently active</span>
<span class="sd">            builder context.</span>

<span class="sd">    Raises:</span>
<span class="sd">        exceptions.BackendNotSet: If the builder does not have a backend set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">backend</span>
    <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">BackendNotSet</span><span class="p">(</span>
            <span class="s1">&#39;This function requires the active builder to &#39;</span>
            <span class="s1">&#39;have a &quot;backend&quot; set.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">builder</span></div>


<span class="k">def</span> <span class="nf">append_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">:</span> <span class="n">Schedule</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a schedule by appending to the active builder&#39;s context schedule.&quot;&quot;&quot;</span>
    <span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">append_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">append_instruction</span><span class="p">(</span><span class="n">instruction</span><span class="p">:</span> <span class="n">instructions</span><span class="o">.</span><span class="n">Instruction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Append an instruction to the active builder&#39;s context schedule.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.builder.append_instruction(pulse.Delay(10, d0))</span>

<span class="sd">        print(pulse_prog.instructions)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">append_instruction</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>


<div class="viewcode-block" id="num_qubits"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.num_qubits.html#qiskit.pulse.builder.num_qubits">[Doku]</a><span class="k">def</span> <span class="nf">num_qubits</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return number of qubits in the currently active backend.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            print(pulse.num_qubits())</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">n_qubits</span></div>


<div class="viewcode-block" id="seconds_to_samples"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.seconds_to_samples.html#qiskit.pulse.builder.seconds_to_samples">[Doku]</a><span class="k">def</span> <span class="nf">seconds_to_samples</span><span class="p">(</span><span class="n">seconds</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Obtain the number of samples that will elapse in ``seconds`` on the</span>
<span class="sd">    active backend.</span>

<span class="sd">    Rounds down.</span>

<span class="sd">    Args:</span>
<span class="sd">        seconds: Time in seconds to convert to samples.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The number of samples for the time to elapse</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">/</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span></div>


<div class="viewcode-block" id="samples_to_seconds"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.samples_to_seconds.html#qiskit.pulse.builder.samples_to_seconds">[Doku]</a><span class="k">def</span> <span class="nf">samples_to_seconds</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Obtain the time in seconds that will elapse for the input number of</span>
<span class="sd">    samples on the active backend.</span>

<span class="sd">    Args:</span>
<span class="sd">        samples: Number of samples to convert to time in seconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The time that elapses in ``samples``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">samples</span> <span class="o">*</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span></div>


<div class="viewcode-block" id="qubit_channels"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.qubit_channels.html#qiskit.pulse.builder.qubit_channels">[Doku]</a><span class="k">def</span> <span class="nf">qubit_channels</span><span class="p">(</span><span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns the set of channels associated with a qubit.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            print(pulse.qubit_channels(0))</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>

<span class="sd">    .. note:: A channel may still be associated with another qubit in this list</span>
<span class="sd">        such as in the case where significant crosstalk exists.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">get_qubit_channels</span><span class="p">(</span><span class="n">qubit</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_qubits_to_channels</span><span class="p">(</span><span class="o">*</span><span class="n">channels_or_qubits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Returns the unique channels of the input qubits.&quot;&quot;&quot;</span>
    <span class="n">channels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">channel_or_qubit</span> <span class="ow">in</span> <span class="n">channels_or_qubits</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_or_qubit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">channels</span> <span class="o">|=</span> <span class="n">qubit_channels</span><span class="p">(</span><span class="n">channel_or_qubit</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_or_qubit</span><span class="p">,</span> <span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">):</span>
            <span class="n">channels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">channel_or_qubit</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">PulseError</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not a &quot;Channel&quot; or &#39;</span>
                <span class="s1">&#39;qubit (integer).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_or_qubit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">channels</span>


<div class="viewcode-block" id="active_transpiler_settings"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.active_transpiler_settings.html#qiskit.pulse.builder.active_transpiler_settings">[Doku]</a><span class="k">def</span> <span class="nf">active_transpiler_settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return the current active builder context&#39;s transpiler settings.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        transpiler_settings = {&#39;optimization_level&#39;: 3}</span>

<span class="sd">        with pulse.build(backend,</span>
<span class="sd">                         default_transpiler_settings=transpiler_settings):</span>
<span class="sd">            print(pulse.active_transpiler_settings())</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">transpiler_settings</span><span class="p">)</span></div>


<span class="c1"># pylint: disable=invalid-name</span>
<div class="viewcode-block" id="active_circuit_scheduler_settings"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.active_circuit_scheduler_settings.html#qiskit.pulse.builder.active_circuit_scheduler_settings">[Doku]</a><span class="k">def</span> <span class="nf">active_circuit_scheduler_settings</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return the current active builder context&#39;s circuit scheduler settings.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        circuit_scheduler_settings = {&#39;method&#39;: &#39;alap&#39;}</span>

<span class="sd">        with pulse.build(</span>
<span class="sd">                backend,</span>
<span class="sd">                default_circuit_scheduler_settings=circuit_scheduler_settings):</span>
<span class="sd">            print(pulse.active_circuit_scheduler_settings())</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">circuit_scheduler_settings</span><span class="p">)</span></div>


<span class="c1"># Contexts</span>
<span class="k">def</span> <span class="nf">_transform_context</span><span class="p">(</span><span class="n">transform</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Schedule</span><span class="p">],</span> <span class="n">Schedule</span><span class="p">],</span>
                       <span class="o">**</span><span class="n">transform_kwargs</span><span class="p">:</span> <span class="n">Any</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;A tranform context generator, decorator.</span>

<span class="sd">    Decorator accepts a transformation function, and then decorates a new</span>
<span class="sd">    ContextManager function.</span>

<span class="sd">    When the context is entered it creates a new schedule, sets it as the</span>
<span class="sd">    builder&#39;s context schedule and then yields.</span>

<span class="sd">    Finally it will reset the initial builder&#39;s context schedule after exiting</span>
<span class="sd">    the context and apply the decorated transform function to the</span>
<span class="sd">    context Schedule. The output transformed schedule will then be</span>
<span class="sd">    appended to the initial builder&#39;s context schedule. This effectively builds a stack</span>
<span class="sd">    of builder&#39;s context schedules that is automatically collapsed upon exiting the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        transform: Transform to decorate as context.</span>
<span class="sd">        transform_kwargs: Additional override keyword arguments for the</span>
<span class="sd">            decorated transform.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A function that generates a new transformation ``ContextManager``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
        <span class="nd">@contextmanager</span>
        <span class="k">def</span> <span class="nf">wrapped_transform</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">builder</span> <span class="o">=</span> <span class="n">_active_builder</span><span class="p">()</span>
            <span class="n">context_schedule</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">context_schedule</span>
            <span class="n">transform_schedule</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">()</span>
            <span class="n">builder</span><span class="o">.</span><span class="n">set_context_schedule</span><span class="p">(</span><span class="n">transform_schedule</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>
                <span class="n">transformed_schedule</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span>
                    <span class="n">transform_schedule</span><span class="p">,</span>
                    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">transform_kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">set_context_schedule</span><span class="p">(</span><span class="n">context_schedule</span><span class="p">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">append_schedule</span><span class="p">(</span><span class="n">transformed_schedule</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapped_transform</span>

    <span class="k">return</span> <span class="n">wrap</span>


<div class="viewcode-block" id="align_left"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.align_left.html#qiskit.pulse.builder.align_left">[Doku]</a><span class="nd">@_transform_context</span><span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">align_left</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">align_left</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Left alignment pulse scheduling context.</span>

<span class="sd">    Pulse instructions within this context are scheduled as early as possible</span>
<span class="sd">    by shifting them left to the earliest available time.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>
<span class="sd">        d1 = pulse.DriveChannel(1)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            with pulse.align_left():</span>
<span class="sd">                # this pulse will start at t=0</span>
<span class="sd">                pulse.play(pulse.Constant(100, 1.0), d0)</span>
<span class="sd">                # this pulse will start at t=0</span>
<span class="sd">                pulse.play(pulse.Constant(20, 1.0), d1)</span>

<span class="sd">        assert pulse_prog.ch_start_time(d0) == pulse_prog.ch_start_time(d1)</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="align_right"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.align_right.html#qiskit.pulse.builder.align_right">[Doku]</a><span class="nd">@_transform_context</span><span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">align_right</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">align_right</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Right alignment pulse scheduling context.</span>

<span class="sd">    Pulse instructions within this context are scheduled as late as possible</span>
<span class="sd">    by shifting them right to the latest available time.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>
<span class="sd">        d1 = pulse.DriveChannel(1)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            with pulse.align_right():</span>
<span class="sd">                # this pulse will start at t=0</span>
<span class="sd">                pulse.play(pulse.Constant(100, 1.0), d0)</span>
<span class="sd">                # this pulse will start at t=80</span>
<span class="sd">                pulse.play(pulse.Constant(20, 1.0), d1)</span>

<span class="sd">        assert pulse_prog.ch_stop_time(d0) == pulse_prog.ch_stop_time(d1)</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="align_sequential"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.align_sequential.html#qiskit.pulse.builder.align_sequential">[Doku]</a><span class="nd">@_transform_context</span><span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">align_sequential</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">align_sequential</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Sequential alignment pulse scheduling context.</span>

<span class="sd">    Pulse instructions within this context are scheduled sequentially in time</span>
<span class="sd">    such that no two instructions will be played at the same time.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>
<span class="sd">        d1 = pulse.DriveChannel(1)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            with pulse.align_sequential():</span>
<span class="sd">                # this pulse will start at t=0</span>
<span class="sd">                pulse.play(pulse.Constant(100, 1.0), d0)</span>
<span class="sd">                # this pulse will also start at t=100</span>
<span class="sd">                pulse.play(pulse.Constant(20, 1.0), d1)</span>

<span class="sd">        assert pulse_prog.ch_stop_time(d0) == pulse_prog.ch_start_time(d1)</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<span class="k">def</span> <span class="nf">_align</span><span class="p">(</span><span class="n">alignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;General alignment context. Used by the :class:`_Builder` to choose the</span>
<span class="sd">    default alignment policy.</span>

<span class="sd">    Args:</span>
<span class="sd">        alignment: Alignment scheduling policy to follow.</span>
<span class="sd">            One of &quot;left&quot;, &quot;right&quot; or &quot;sequential&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An alignment context that will schedule the instructions it contains</span>
<span class="sd">        according to the selected alignment policy upon exiting the context.</span>

<span class="sd">    Raises:</span>
<span class="sd">        exceptions.PulseError: If an unsupported alignment context is selected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">align_left</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">align_right</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s1">&#39;sequential&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">align_sequential</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">PulseError</span><span class="p">(</span><span class="s1">&#39;Alignment &quot;</span><span class="si">{}</span><span class="s1">&quot; is not &#39;</span>
                                    <span class="s1">&#39;supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alignment</span><span class="p">))</span>


<div class="viewcode-block" id="inline"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.inline.html#qiskit.pulse.builder.inline">[Doku]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">inline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Inline all instructions within this context into the parent context,</span>
<span class="sd">    inheriting the scheduling policy of the parent context.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>
<span class="sd">        d1 = pulse.DriveChannel(1)</span>
<span class="sd">        d2 = pulse.DriveChannel(2)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            # will be ignored due to internal grouping</span>
<span class="sd">            with pulse.align_left():</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d0)</span>
<span class="sd">                with pulse.inline():</span>
<span class="sd">                    with pulse.align_right():</span>
<span class="sd">                        # this pulse will start at t=0</span>
<span class="sd">                        pulse.play(pulse.Constant(100, 1.0), d1)</span>
<span class="sd">                        # this pulse will also start at t=0</span>
<span class="sd">                        pulse.play(pulse.Constant(20, 1.0), d2)</span>

<span class="sd">        assert (pulse_prog.ch_start_time(d0) ==</span>
<span class="sd">                pulse_prog.ch_start_time(d1) ==</span>
<span class="sd">                pulse_prog.ch_start_time(d2))</span>

<span class="sd">    .. warning:: This will cause all scheduling directives within this context</span>
<span class="sd">        to be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">_active_builder</span><span class="p">()</span>
    <span class="n">context_schedule</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">context_schedule</span>
    <span class="n">transform_schedule</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">()</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">set_context_schedule</span><span class="p">(</span><span class="n">transform_schedule</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">_compile_lazy_circuit</span><span class="p">()</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">set_context_schedule</span><span class="p">(</span><span class="n">context_schedule</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">instruction</span> <span class="ow">in</span> <span class="n">transform_schedule</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="n">append_instruction</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span></div>


<div class="viewcode-block" id="pad"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.pad.html#qiskit.pulse.builder.pad">[Doku]</a><span class="nd">@_transform_context</span><span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">pad</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="o">*</span><span class="n">chs</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>  <span class="c1"># pylint: disable=unused-argument</span>
    <span class="sd">&quot;&quot;&quot;Pad all availale timeslots with delays upon exiting context.</span>

<span class="sd">    Args:</span>
<span class="sd">        chs: Channels to pad with delays. Defaults to all channels in context</span>
<span class="sd">            if none are supplied.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>
<span class="sd">        d1 = pulse.DriveChannel(1)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            with pulse.pad():</span>
<span class="sd">                with pulse.align_right():</span>
<span class="sd">                    # this pulse will start at t=0</span>
<span class="sd">                    pulse.play(pulse.Constant(100, 1.0), d0)</span>
<span class="sd">                    # this pulse will start at t=80</span>
<span class="sd">                    # a delay will be inserted from t=0 to t=80</span>
<span class="sd">                    pulse.play(pulse.Constant(20, 1.0), d1)</span>
<span class="sd">        assert pulse_prog.ch_start_time(d0) == pulse_prog.ch_start_time(d1)</span>
<span class="sd">        assert pulse_prog.ch_stop_time(d0) == pulse_prog.ch_stop_time(d1)</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="transpiler_settings"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.transpiler_settings.html#qiskit.pulse.builder.transpiler_settings">[Doku]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">transpiler_settings</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Set the currently active transpiler settings for this context.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            print(pulse.active_transpiler_settings())</span>
<span class="sd">            with pulse.transpiler_settings(optimization_level=3):</span>
<span class="sd">                print(pulse.active_transpiler_settings())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">_active_builder</span><span class="p">()</span>
    <span class="n">curr_transpiler_settings</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">transpiler_settings</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">transpiler_settings</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">ChainMap</span><span class="p">(</span>
        <span class="n">settings</span><span class="p">,</span> <span class="n">curr_transpiler_settings</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">transpiler_settings</span> <span class="o">=</span> <span class="n">curr_transpiler_settings</span></div>


<div class="viewcode-block" id="circuit_scheduler_settings"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.circuit_scheduler_settings.html#qiskit.pulse.builder.circuit_scheduler_settings">[Doku]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">circuit_scheduler_settings</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Set the currently active circuit scheduler settings for this context.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            print(pulse.active_circuit_scheduler_settings())</span>
<span class="sd">            with pulse.circuit_scheduler_settings(method=&#39;alap&#39;):</span>
<span class="sd">                print(pulse.active_circuit_scheduler_settings())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">_active_builder</span><span class="p">()</span>
    <span class="n">curr_circuit_scheduler_settings</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">circuit_scheduler_settings</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">circuit_scheduler_settings</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">ChainMap</span><span class="p">(</span>
        <span class="n">settings</span><span class="p">,</span> <span class="n">curr_circuit_scheduler_settings</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">circuit_scheduler_settings</span> <span class="o">=</span> <span class="n">curr_circuit_scheduler_settings</span></div>


<div class="viewcode-block" id="phase_offset"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.phase_offset.html#qiskit.pulse.builder.phase_offset">[Doku]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">phase_offset</span><span class="p">(</span><span class="n">phase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">channels</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Shift the phase of input channels on entry into context and undo on exit.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        import math</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            with pulse.phase_offset(math.pi, d0):</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d0)</span>

<span class="sd">        assert len(pulse_prog.instructions) == 3</span>

<span class="sd">    Args:</span>
<span class="sd">        phase: Amount of phase offset in radians.</span>
<span class="sd">        channels: Channels to offset phase of.</span>

<span class="sd">    Yields:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
        <span class="n">shift_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">shift_phase</span><span class="p">(</span><span class="o">-</span><span class="n">phase</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span></div>


<div class="viewcode-block" id="frequency_offset"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.frequency_offset.html#qiskit.pulse.builder.frequency_offset">[Doku]</a><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">frequency_offset</span><span class="p">(</span><span class="n">frequency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                     <span class="o">*</span><span class="n">channels</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span><span class="p">,</span>
                     <span class="n">compensate_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Shift the frequency of inputs channels on entry into context and undo on exit.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :emphasize-lines: 7, 16</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            # shift frequency by 1GHz</span>
<span class="sd">            with pulse.frequency_offset(1e9, d0):</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d0)</span>

<span class="sd">        assert len(pulse_prog.instructions) == 3</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            # Shift frequency by 1GHz.</span>
<span class="sd">            # Undo accumulated phase in the shifted freqeuncy frame</span>
<span class="sd">            # when exiting the context.</span>
<span class="sd">            with pulse.frequency_offset(1e9, d0, compensate_phase=True):</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d0)</span>

<span class="sd">        assert len(pulse_prog.instructions) == 4</span>

<span class="sd">    Args:</span>
<span class="sd">        frequency: Amount of frequency offset in Hz.</span>
<span class="sd">        channels: Channels to offset phase of.</span>
<span class="sd">        compensate_phase: Compensate for accumulated phase in accumulated with</span>
<span class="sd">            respect to the channels frame at its initial frequency.</span>

<span class="sd">    Yields:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">_active_builder</span><span class="p">()</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">context_schedule</span><span class="o">.</span><span class="n">duration</span>

    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
        <span class="n">shift_frequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">compensate_phase</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">context_schedule</span><span class="o">.</span><span class="n">duration</span> <span class="o">-</span> <span class="n">t0</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span>
            <span class="n">accumulated_phase</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">frequency</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="n">shift_phase</span><span class="p">(</span><span class="o">-</span><span class="n">accumulated_phase</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">shift_frequency</span><span class="p">(</span><span class="o">-</span><span class="n">frequency</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span></div>


<span class="c1"># Channels</span>
<div class="viewcode-block" id="drive_channel"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.drive_channel.html#qiskit.pulse.builder.drive_channel">[Doku]</a><span class="k">def</span> <span class="nf">drive_channel</span><span class="p">(</span><span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chans</span><span class="o">.</span><span class="n">DriveChannel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return ``DriveChannel`` for ``qubit`` on the active builder backend.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            assert pulse.drive_channel(0) == pulse.DriveChannel(0)</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">drive</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span></div>


<div class="viewcode-block" id="measure_channel"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.measure_channel.html#qiskit.pulse.builder.measure_channel">[Doku]</a><span class="k">def</span> <span class="nf">measure_channel</span><span class="p">(</span><span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chans</span><span class="o">.</span><span class="n">MeasureChannel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return ``MeasureChannel`` for ``qubit`` on the active builder backend.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            assert pulse.measure_channel(0) == pulse.MeasureChannel(0)</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span></div>


<div class="viewcode-block" id="acquire_channel"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.acquire_channel.html#qiskit.pulse.builder.acquire_channel">[Doku]</a><span class="k">def</span> <span class="nf">acquire_channel</span><span class="p">(</span><span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chans</span><span class="o">.</span><span class="n">AcquireChannel</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return ``AcquireChannel`` for ``qubit`` on the active builder backend.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            assert pulse.acquire_channel(0) == pulse.AcquireChannel(0)</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span></div>


<div class="viewcode-block" id="control_channels"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.control_channels.html#qiskit.pulse.builder.control_channels">[Doku]</a><span class="k">def</span> <span class="nf">control_channels</span><span class="p">(</span><span class="o">*</span><span class="n">qubits</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">ControlChannel</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Return ``AcquireChannel`` for ``qubit`` on the active builder backend.</span>

<span class="sd">    Return the secondary drive channel for the given qubit -- typically</span>
<span class="sd">    utilized for controlling multi-qubit interactions.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>
<span class="sd">        with pulse.build(backend):</span>
<span class="sd">            assert pulse.control_channels(0, 1) == [pulse.ControlChannel(0)]</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>

<span class="sd">    Args:</span>
<span class="sd">      qubits: Tuple or list of ordered qubits of the form</span>
<span class="sd">        `(control_qubit, target_qubit)`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of control channels associated with the supplied ordered list</span>
<span class="sd">        of qubits.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">active_backend</span><span class="p">()</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="n">qubits</span><span class="o">=</span><span class="n">qubits</span><span class="p">)</span></div>


<span class="c1"># Base Instructions</span>
<div class="viewcode-block" id="delay"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.delay.html#qiskit.pulse.builder.delay">[Doku]</a><span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
          <span class="n">channel</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Delay on a ``channel`` for a ``duration``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.delay(10, d0)</span>

<span class="sd">    Args:</span>
<span class="sd">        duration: Number of cycles to delay for on ``channel``.</span>
<span class="sd">        channel: Channel to delay on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">Delay</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span></div>


<div class="viewcode-block" id="play"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.play.html#qiskit.pulse.builder.play">[Doku]</a><span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="n">pulse</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">library</span><span class="o">.</span><span class="n">Pulse</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
         <span class="n">channel</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Play a ``pulse`` on a ``channel``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.play(pulse.Constant(10, 1.0), d0)</span>

<span class="sd">    Args:</span>
<span class="sd">        pulse: Pulse to play.</span>
<span class="sd">        channel: Channel to play pulse on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pulse</span><span class="p">,</span> <span class="n">library</span><span class="o">.</span><span class="n">Pulse</span><span class="p">):</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">library</span><span class="o">.</span><span class="n">Waveform</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span>

    <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">Play</span><span class="p">(</span><span class="n">pulse</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span></div>


<div class="viewcode-block" id="acquire"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.acquire.html#qiskit.pulse.builder.acquire">[Doku]</a><span class="k">def</span> <span class="nf">acquire</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">qubit_or_channel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">chans</span><span class="o">.</span><span class="n">AcquireChannel</span><span class="p">],</span>
            <span class="n">register</span><span class="p">:</span> <span class="n">StorageLocation</span><span class="p">,</span>
            <span class="o">**</span><span class="n">metadata</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">configuration</span><span class="o">.</span><span class="n">Kernel</span><span class="p">,</span>
                              <span class="n">configuration</span><span class="o">.</span><span class="n">Discriminator</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Acquire for a ``duration`` on a ``channel`` and store the result</span>
<span class="sd">    in a ``register``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.MeasureChannel(0)</span>
<span class="sd">        mem0 = pulse.MemorySlot(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.acquire(100, d0, mem0)</span>

<span class="sd">            # measurement metadata</span>
<span class="sd">            kernel = pulse.configuration.Kernel(&#39;linear_discriminator&#39;)</span>
<span class="sd">            pulse.acquire(100, d0, mem0, kernel=kernel)</span>

<span class="sd">    .. note:: The type of data acquire will depend on the execution</span>
<span class="sd">        ``meas_level``.</span>

<span class="sd">    Args:</span>
<span class="sd">        duration: Duration to acquire data for</span>
<span class="sd">        qubit_or_channel: Either the qubit to acquire data for or the specific</span>
<span class="sd">            :class:`~qiskit.pulse.channels.AcquireChannel` to acquire on.</span>
<span class="sd">        register: Location to store measured result.</span>
<span class="sd">        metadata: Additional metadata for measurement. See</span>
<span class="sd">            :class:`~qiskit.pulse.instructions.Acquire` for more information.</span>

<span class="sd">    Raises:</span>
<span class="sd">        exceptions.PulseError: If the register type is not supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qubit_or_channel</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">qubit_or_channel</span> <span class="o">=</span> <span class="n">chans</span><span class="o">.</span><span class="n">AcquireChannel</span><span class="p">(</span><span class="n">qubit_or_channel</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="n">chans</span><span class="o">.</span><span class="n">MemorySlot</span><span class="p">):</span>
        <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">Acquire</span><span class="p">(</span>
            <span class="n">duration</span><span class="p">,</span> <span class="n">qubit_or_channel</span><span class="p">,</span> <span class="n">mem_slot</span><span class="o">=</span><span class="n">register</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">register</span><span class="p">,</span> <span class="n">chans</span><span class="o">.</span><span class="n">RegisterSlot</span><span class="p">):</span>
        <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">Acquire</span><span class="p">(</span>
            <span class="n">duration</span><span class="p">,</span> <span class="n">qubit_or_channel</span><span class="p">,</span> <span class="n">reg_slot</span><span class="o">=</span><span class="n">register</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">PulseError</span><span class="p">(</span>
            <span class="s1">&#39;Register of type: &quot;</span><span class="si">{}</span><span class="s1">&quot; is not supported&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">register</span><span class="p">)))</span></div>


<div class="viewcode-block" id="set_frequency"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.set_frequency.html#qiskit.pulse.builder.set_frequency">[Doku]</a><span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                  <span class="n">channel</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the ``frequency`` of a pulse ``channel``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.set_frequency(1e9, d0)</span>

<span class="sd">    Args:</span>
<span class="sd">        frequency: Frequency in Hz to set channel to.</span>
<span class="sd">        channel: Channel to set frequency of.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">SetFrequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span></div>


<div class="viewcode-block" id="shift_frequency"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.shift_frequency.html#qiskit.pulse.builder.shift_frequency">[Doku]</a><span class="k">def</span> <span class="nf">shift_frequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">channel</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shift the ``frequency`` of a pulse ``channel``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :emphasize-lines: 6</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.shift_frequency(1e9, d0)</span>

<span class="sd">    Args:</span>
<span class="sd">        frequency: Frequency in Hz to shift channel frequency by.</span>
<span class="sd">        channel: Channel to shift frequency of.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">ShiftFrequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span></div>


<div class="viewcode-block" id="set_phase"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.set_phase.html#qiskit.pulse.builder.set_phase">[Doku]</a><span class="k">def</span> <span class="nf">set_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
              <span class="n">channel</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the ``phase`` of a pulse ``channel``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. code-block:: python</span>
<span class="sd">        :emphasize-lines: 8</span>

<span class="sd">        import math</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.set_phase(math.pi, d0)</span>

<span class="sd">    Args:</span>
<span class="sd">        phase: Phase in radians to set channel carrier signal to.</span>
<span class="sd">        channel: Channel to set phase of.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">SetPhase</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span></div>


<div class="viewcode-block" id="shift_phase"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.shift_phase.html#qiskit.pulse.builder.shift_phase">[Doku]</a><span class="k">def</span> <span class="nf">shift_phase</span><span class="p">(</span><span class="n">phase</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                <span class="n">channel</span><span class="p">:</span> <span class="n">chans</span><span class="o">.</span><span class="n">PulseChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Shift the ``phase`` of a pulse ``channel``.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        import math</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.shift_phase(math.pi, d0)</span>

<span class="sd">    Args:</span>
<span class="sd">        phase: Phase in radians to shift channel carrier signal by.</span>
<span class="sd">        channel: Channel to shift phase of.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_instruction</span><span class="p">(</span><span class="n">instructions</span><span class="o">.</span><span class="n">ShiftPhase</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span></div>


<div class="viewcode-block" id="snapshot"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.snapshot.html#qiskit.pulse.builder.snapshot">[Doku]</a><span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">snapshot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;statevector&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simulator snapshot.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            pulse.snapshot(&#39;first&#39;, &#39;statevector&#39;)</span>

<span class="sd">    Args:</span>
<span class="sd">        label: Label for snapshot.</span>
<span class="sd">        snapshot_type: Type of snapshot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">append_instruction</span><span class="p">(</span>
        <span class="n">instructions</span><span class="o">.</span><span class="n">Snapshot</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">snapshot_type</span><span class="o">=</span><span class="n">snapshot_type</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">call_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">:</span> <span class="n">Schedule</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a pulse ``schedule`` in the builder context.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.pulse import builder</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        sched = pulse.Schedule()</span>
<span class="sd">        sched += pulse.Play(pulse.Constant(10, 1.0), d0)</span>

<span class="sd">        with pulse.build() as pulse_prog:</span>
<span class="sd">            builder.call_schedule(sched)</span>

<span class="sd">        assert pulse_prog == sched</span>

<span class="sd">    Args:</span>
<span class="sd">        Schedule to call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">call_schedule</span><span class="p">(</span><span class="n">schedule</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">call_circuit</span><span class="p">(</span><span class="n">circ</span><span class="p">:</span> <span class="n">circuit</span><span class="o">.</span><span class="n">QuantumCircuit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a quantum ``circuit`` within the active builder context.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import circuit, pulse, schedule, transpile</span>
<span class="sd">        from qiskit.pulse import builder</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        qc = circuit.QuantumCircuit(2)</span>
<span class="sd">        qc.cx(0, 1)</span>
<span class="sd">        qc_transpiled = transpile(qc, optimization_level=3)</span>
<span class="sd">        sched = schedule(qc_transpiled, backend)</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            # with default settings</span>
<span class="sd">            builder.call_circuit(qc)</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            with pulse.transpiler_settings(optimization_level=3):</span>
<span class="sd">                builder.call_circuit(qc)</span>

<span class="sd">        assert pulse_prog == sched</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>

<span class="sd">    Args:</span>
<span class="sd">        Circuit to call.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">call_circuit</span><span class="p">(</span><span class="n">circ</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<div class="viewcode-block" id="call"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.call.html#qiskit.pulse.builder.call">[Doku]</a><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">circuit</span><span class="o">.</span><span class="n">QuantumCircuit</span><span class="p">,</span> <span class="n">Schedule</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Call the ``target`` within the currently active builder context.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import circuit, pulse, schedule, transpile</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        qc = circuit.QuantumCircuit(2)</span>
<span class="sd">        qc.cx(0, 1)</span>
<span class="sd">        qc_transpiled = transpile(qc, optimization_level=3)</span>
<span class="sd">        sched = schedule(qc_transpiled, backend)</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">                pulse.call(sched)</span>
<span class="sd">                pulse.call(qc)</span>

<span class="sd">    Args:</span>
<span class="sd">        target: Target circuit or pulse schedule to call.</span>

<span class="sd">    Raises:</span>
<span class="sd">        exceptions.PulseError: If the input ``target`` type is not supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">circuit</span><span class="o">.</span><span class="n">QuantumCircuit</span><span class="p">):</span>
        <span class="n">call_circuit</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Schedule</span><span class="p">):</span>
        <span class="n">call_schedule</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">PulseError</span><span class="p">(</span>
            <span class="s1">&#39;Target of type &quot;</span><span class="si">{}</span><span class="s1">&quot; is not supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)))</span></div>


<span class="c1"># Directives</span>
<div class="viewcode-block" id="barrier"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.barrier.html#qiskit.pulse.builder.barrier">[Doku]</a><span class="k">def</span> <span class="nf">barrier</span><span class="p">(</span><span class="o">*</span><span class="n">channels_or_qubits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">Channel</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Barrier directive for a set of channels and qubits.</span>

<span class="sd">    This directive prevents the compiler from moving instructions across</span>
<span class="sd">    the barrier. Consider the case where we want to enforce that one pulse</span>
<span class="sd">    happens after another on separate channels, this can be done with:</span>

<span class="sd">    .. jupyter-kernel:: python3</span>
<span class="sd">        :id: barrier</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>
<span class="sd">        d1 = pulse.DriveChannel(1)</span>

<span class="sd">        with pulse.build(backend) as barrier_pulse_prog:</span>
<span class="sd">            pulse.play(pulse.Constant(10, 1.0), d0)</span>
<span class="sd">            pulse.barrier(d0, d1)</span>
<span class="sd">            pulse.play(pulse.Constant(10, 1.0), d1)</span>

<span class="sd">    Of course this could have been accomplished with:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit.pulse import transforms</span>

<span class="sd">        with pulse.build(backend) as aligned_pulse_prog:</span>
<span class="sd">            with pulse.align_sequential():</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d0)</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d1)</span>

<span class="sd">        barrier_pulse_prog = transforms.remove_directives(barrier_pulse_prog)</span>
<span class="sd">        assert barrier_pulse_prog == aligned_pulse_prog</span>

<span class="sd">    The barrier allows the pulse compiler to take care of more advanced</span>
<span class="sd">    scheduling aligment operations across channels. For example</span>
<span class="sd">    in the case where we are calling an outside circuit or schedule and</span>
<span class="sd">    want to align a pulse at the end of one call:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        import math</span>

<span class="sd">        d0 = pulse.DriveChannel(0)</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            with pulse.align_right():</span>
<span class="sd">                pulse.x(1)</span>
<span class="sd">                # Barrier qubit 1 and d0.</span>
<span class="sd">                pulse.barrier(1, d0)</span>
<span class="sd">                # Due to barrier this will play before the gate on qubit 1.</span>
<span class="sd">                pulse.play(pulse.Constant(10, 1.0), d0)</span>
<span class="sd">                # This will end at the same time as the pulse above due to</span>
<span class="sd">                # the barrier.</span>
<span class="sd">                pulse.x(1)</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set if</span>
<span class="sd">        qubits are barriered on.</span>

<span class="sd">    Args:</span>
<span class="sd">        channels_or_qubits: Channels or qubits to barrier.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">channels</span> <span class="o">=</span> <span class="n">_qubits_to_channels</span><span class="p">(</span><span class="o">*</span><span class="n">channels_or_qubits</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">append_instruction</span><span class="p">(</span><span class="n">directives</span><span class="o">.</span><span class="n">RelativeBarrier</span><span class="p">(</span><span class="o">*</span><span class="n">channels</span><span class="p">))</span></div>


<span class="c1"># Macros</span>
<div class="viewcode-block" id="measure"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.measure.html#qiskit.pulse.builder.measure">[Doku]</a><span class="k">def</span> <span class="nf">measure</span><span class="p">(</span><span class="n">qubits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">registers</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">StorageLocation</span><span class="p">],</span> <span class="n">StorageLocation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">StorageLocation</span><span class="p">],</span> <span class="n">StorageLocation</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Measure a qubit within the currently active builder context.</span>

<span class="sd">    At the pulse level a measurement is composed of both a stimulus pulse and</span>
<span class="sd">    an acquisition instruction which tells the systems measurement unit to</span>
<span class="sd">    acquire data and process it. We provide this measurement macro to automate</span>
<span class="sd">    the process for you, but if desired full control is still available with</span>
<span class="sd">    :func:`acquire` and :func:`play`.</span>

<span class="sd">    To use the measurement it is as simple as specifying the qubit you wish to</span>
<span class="sd">    measure:</span>

<span class="sd">    .. jupyter-kernel:: python3</span>
<span class="sd">        :id: measure</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        qubit = 0</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            # Do something to the qubit.</span>
<span class="sd">            qubit_drive_chan = pulse.drive_channel(0)</span>
<span class="sd">            pulse.play(pulse.Constant(100, 1.0), qubit_drive_chan)</span>
<span class="sd">            # Measure the qubit.</span>
<span class="sd">            reg = pulse.measure(qubit)</span>

<span class="sd">    For now it is not possible to do much with the handle to ``reg`` but in the</span>
<span class="sd">    future we will support using this handle to a result register to build</span>
<span class="sd">    up ones program. It is also possible to supply this register:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            pulse.play(pulse.Constant(100, 1.0), qubit_drive_chan)</span>
<span class="sd">            # Measure the qubit.</span>
<span class="sd">            mem0 = pulse.MemorySlot(0)</span>
<span class="sd">            reg = pulse.measure(qubit, mem0)</span>

<span class="sd">        assert reg == mem0</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>

<span class="sd">    Args:</span>
<span class="sd">        qubits: Physical qubit to measure.</span>
<span class="sd">        registers: Register to store result in. If not selected the current</span>
<span class="sd">            behaviour is to return the :class:`MemorySlot` with the same</span>
<span class="sd">            index as ``qubit``. This register will be returned.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The ``register`` the qubit measurement result will be stored in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">active_backend</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">qubits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">qubits</span> <span class="o">=</span> <span class="p">[</span><span class="n">qubits</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">registers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">registers</span> <span class="o">=</span> <span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">MemorySlot</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">registers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">registers</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">registers</span> <span class="o">=</span> <span class="p">[</span><span class="n">registers</span><span class="p">]</span>

    <span class="n">measure_sched</span> <span class="o">=</span> <span class="n">macros</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span>
        <span class="n">qubits</span><span class="o">=</span><span class="n">qubits</span><span class="p">,</span>
        <span class="n">inst_map</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span><span class="o">.</span><span class="n">instruction_schedule_map</span><span class="p">,</span>
        <span class="n">meas_map</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">meas_map</span><span class="p">,</span>
        <span class="n">qubit_mem_slots</span><span class="o">=</span><span class="p">{</span><span class="n">qubit</span><span class="p">:</span> <span class="n">register</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">qubit</span><span class="p">,</span> <span class="n">register</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">qubits</span><span class="p">,</span> <span class="n">registers</span><span class="p">)})</span>
    <span class="n">call_schedule</span><span class="p">(</span><span class="n">measure_sched</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qubits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">registers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">registers</span></div>


<div class="viewcode-block" id="measure_all"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.measure_all.html#qiskit.pulse.builder.measure_all">[Doku]</a><span class="k">def</span> <span class="nf">measure_all</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">MemorySlot</span><span class="p">]:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Measure all qubits within the currently active builder context.</span>

<span class="sd">    A simple macro function to measure all of the qubits in the device at the</span>
<span class="sd">    same time. This is useful for handling device ``meas_map`` and single</span>
<span class="sd">    measurement constraints.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            # Measure all qubits and return associated registers.</span>
<span class="sd">            regs = pulse.measure_all()</span>

<span class="sd">    .. note::</span>
<span class="sd">        Requires the active builder context to have a backend set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ``register``\s the qubit measurement results will be stored in.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">active_backend</span><span class="p">()</span>
    <span class="n">qubits</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_qubits</span><span class="p">())</span>
    <span class="n">registers</span> <span class="o">=</span> <span class="p">[</span><span class="n">chans</span><span class="o">.</span><span class="n">MemorySlot</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">]</span>
    <span class="n">measure_sched</span> <span class="o">=</span> <span class="n">macros</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span>
        <span class="n">qubits</span><span class="o">=</span><span class="n">qubits</span><span class="p">,</span>
        <span class="n">inst_map</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">defaults</span><span class="p">()</span><span class="o">.</span><span class="n">instruction_schedule_map</span><span class="p">,</span>
        <span class="n">meas_map</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">configuration</span><span class="p">()</span><span class="o">.</span><span class="n">meas_map</span><span class="p">,</span>
        <span class="n">qubit_mem_slots</span><span class="o">=</span><span class="p">{</span><span class="n">qubit</span><span class="p">:</span> <span class="n">qubit</span> <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">})</span>
    <span class="n">call_schedule</span><span class="p">(</span><span class="n">measure_sched</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">registers</span></div>


<div class="viewcode-block" id="delay_qubits"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.delay_qubits.html#qiskit.pulse.builder.delay_qubits">[Doku]</a><span class="k">def</span> <span class="nf">delay_qubits</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">qubits</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Insert delays on all of the :class:`channels.Channel`\s that correspond</span>
<span class="sd">    to the input ``qubits`` at the same time.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse3Q</span>

<span class="sd">        backend = FakeOpenPulse3Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            # Delay for 100 cycles on qubits 0, 1 and 2.</span>
<span class="sd">            regs = pulse.delay_qubits(100, 0, 1, 2)</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>

<span class="sd">    Args:</span>
<span class="sd">        duration: Duration to delay for.</span>
<span class="sd">        qubits: Physical qubits to delay on. Delays will be inserted based on</span>
<span class="sd">            the channels returned by :func:`pulse.qubit_channels`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qubit_chans</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
        <span class="n">qubit_channels</span><span class="p">(</span><span class="n">qubit</span><span class="p">)</span> <span class="k">for</span> <span class="n">qubit</span> <span class="ow">in</span> <span class="n">qubits</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">align_left</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">chan</span> <span class="ow">in</span> <span class="n">qubit_chans</span><span class="p">:</span>
            <span class="n">delay</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span></div>


<span class="c1"># Gate instructions</span>
<span class="k">def</span> <span class="nf">call_gate</span><span class="p">(</span><span class="n">gate</span><span class="p">:</span> <span class="n">circuit</span><span class="o">.</span><span class="n">Gate</span><span class="p">,</span> <span class="n">qubits</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">lazy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a gate and lazily schedule it to its corresponding</span>
<span class="sd">    pulse instruction.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    .. jupyter-kernel:: python3</span>
<span class="sd">        :id: call_gate</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.pulse import builder</span>
<span class="sd">        from qiskit.circuit.library import standard_gates as gates</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            builder.call_gate(gates.CXGate(), (0, 1))</span>

<span class="sd">    We can see the role of the transpiler in scheduling gates by optimizing</span>
<span class="sd">    away two consecutive CNOT gates:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            with pulse.transpiler_settings(optimization_level=3):</span>
<span class="sd">                builder.call_gate(gates.CXGate(), (0, 1))</span>
<span class="sd">                builder.call_gate(gates.CXGate(), (0, 1))</span>

<span class="sd">        assert pulse_prog == pulse.Schedule()</span>

<span class="sd">    .. note:: If multiple gates are called in a row they may be optimized by</span>
<span class="sd">        the transpiler, depending on the</span>
<span class="sd">        :func:`pulse.active_transpiler_settings``.</span>

<span class="sd">    .. note:: Requires the active builder context to have a backend set.</span>

<span class="sd">    Args:</span>
<span class="sd">        gate: Circuit gate instance to call.</span>
<span class="sd">        qubits: Qubits to call gate on.</span>
<span class="sd">        lazy: If ``false`` the gate will be compiled immediately, otherwise</span>
<span class="sd">            it will be added onto a lazily evaluated quantum circuit to be</span>
<span class="sd">            compiled when the builder is forced to by a circuit assumption</span>
<span class="sd">            being broken, such as the inclusion of a pulse instruction or</span>
<span class="sd">            new alignment context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_active_builder</span><span class="p">()</span><span class="o">.</span><span class="n">call_gate</span><span class="p">(</span><span class="n">gate</span><span class="p">,</span> <span class="n">qubits</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="n">lazy</span><span class="p">)</span>


<div class="viewcode-block" id="cx"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.cx.html#qiskit.pulse.builder.cx">[Doku]</a><span class="k">def</span> <span class="nf">cx</span><span class="p">(</span><span class="n">control</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a :class:`~qiskit.circuit.library.standard_gates.CXGate` on the</span>
<span class="sd">    input physical qubits.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            pulse.cx(0, 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_gate</span><span class="p">(</span><span class="n">gates</span><span class="o">.</span><span class="n">CXGate</span><span class="p">(),</span> <span class="p">(</span><span class="n">control</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span></div>


<div class="viewcode-block" id="u1"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.u1.html#qiskit.pulse.builder.u1">[Doku]</a><span class="k">def</span> <span class="nf">u1</span><span class="p">(</span><span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a :class:`~qiskit.circuit.library.standard_gates.U1Gate` on the</span>
<span class="sd">    input physical qubit.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        import math</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            pulse.u1(math.pi, 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_gate</span><span class="p">(</span><span class="n">gates</span><span class="o">.</span><span class="n">U1Gate</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">qubit</span><span class="p">)</span></div>


<div class="viewcode-block" id="u2"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.u2.html#qiskit.pulse.builder.u2">[Doku]</a><span class="k">def</span> <span class="nf">u2</span><span class="p">(</span><span class="n">phi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lam</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a :class:`~qiskit.circuit.library.standard_gates.U2Gate` on the</span>
<span class="sd">    input physical qubit.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        import math</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            pulse.u2(0, math.pi, 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_gate</span><span class="p">(</span><span class="n">gates</span><span class="o">.</span><span class="n">U2Gate</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">lam</span><span class="p">),</span> <span class="n">qubit</span><span class="p">)</span></div>


<div class="viewcode-block" id="u3"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.u3.html#qiskit.pulse.builder.u3">[Doku]</a><span class="k">def</span> <span class="nf">u3</span><span class="p">(</span><span class="n">theta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">phi</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">lam</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a :class:`~qiskit.circuit.library.standard_gates.U3Gate` on the</span>
<span class="sd">    input physical qubit.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        import math</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            pulse.u3(math.pi, 0, math.pi, 1)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_gate</span><span class="p">(</span><span class="n">gates</span><span class="o">.</span><span class="n">U3Gate</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">lam</span><span class="p">),</span> <span class="n">qubit</span><span class="p">)</span></div>


<div class="viewcode-block" id="x"><a class="viewcode-back" href="../../../stubs/qiskit.pulse.builder.x.html#qiskit.pulse.builder.x">[Doku]</a><span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">qubit</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call a :class:`~qiskit.circuit.library.standard_gates.XGate` on the</span>
<span class="sd">    input physical qubit.</span>

<span class="sd">    .. note::</span>
<span class="sd">        Calling gates directly within the pulse builder namespace will be</span>
<span class="sd">        deprecated in the future in favour of tight integration with a circuit</span>
<span class="sd">        builder interface which is under development.</span>

<span class="sd">    Examples:</span>

<span class="sd">    .. jupyter-execute::</span>

<span class="sd">        from qiskit import pulse</span>
<span class="sd">        from qiskit.test.mock import FakeOpenPulse2Q</span>

<span class="sd">        backend = FakeOpenPulse2Q()</span>

<span class="sd">        with pulse.build(backend) as pulse_prog:</span>
<span class="sd">            pulse.x(0)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">call_gate</span><span class="p">(</span><span class="n">gates</span><span class="o">.</span><span class="n">XGate</span><span class="p">(),</span> <span class="n">qubit</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Qiskit Development Team
      <span class="lastupdated">
        Zuletzt aktualisiert am 2020/08/18.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Zu sehen ist</span>
    lang: German
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>Sprachen</dt>
      
        <dd><a class="version" href="/documentation/_modules/qiskit/pulse/builder.html">English</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ja_JP/_modules/qiskit/pulse/builder.html">Japanese</a></dd>
      
        <dd><a class="version" href="/documentation/locale/de_DE/_modules/qiskit/pulse/builder.html">German</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ko_KR/_modules/qiskit/pulse/builder.html">Korean</a></dd>
      
    </dl>
    
  </div>
  <script>
    jQuery('.version').click((evt) => {
      const hash = window.location.hash
      const complete_url = evt.target.href + hash
      window.location = complete_url
      evt.preventDefault()
    })
  </script>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>